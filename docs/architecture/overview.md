# Архитектура WifiGuard

## Обзор архитектуры

WifiGuard построен на принципах **Clean Architecture** и **MVVM (Model-View-ViewModel)** с использованием современных библиотек Android.

### Архитектурные слои

```
┌─────────────────────────────────────────────────────────┐
│                        UI Layer                         │
│                   Jetpack Compose                       │
├─────────────────────────────────────────────────────────┤
│                     Presentation Layer                  │
│                   ViewModels, States                    │
├─────────────────────────────────────────────────────────┤
│                      Domain Layer                       │
│              Use Cases, Entities, Repositories          │
├─────────────────────────────────────────────────────────┤
│                      Data Layer                         │
│         Local Data Sources, Remote Data Sources         │
└─────────────────────────────────────────────────────────┘
```

## Модульная структура

### Core модули

#### `core.background`
- **Назначение**: Фоновые задачи и планирование
- **Компоненты**: WorkManager, планировщики задач, фоновые сервисы
- **Основные классы**: `WifiMonitoringWorker`, `ThreatNotificationWorker`, `DataCleanupWorker`

#### `core.common`
- **Назначение**: Общие константы и утилиты
- **Компоненты**: `Constants.kt`, утилиты
- **Основные классы**: `Constants`

#### `core.data`
- **Назначение**: Источники данных
- **Подмодули**:
  - `local`: Room Database, DAO, Entity
  - `wifi`: Wi-Fi сканер, обработчики событий

#### `core.domain`
- **Назначение**: Бизнес-логика приложения
- **Компоненты**: Use cases, доменные сущности, репозитории

#### `core.monitoring`
- **Назначение**: Мониторинг подключений
- **Компоненты**: `WifiConnectionObserver` для автоматических уведомлений о подключениях

#### `core.notification`
- **Назначение**: Система уведомлений
- **Компоненты**: Создание и управление уведомлениями

#### `core.security`
- **Назначение**: Безопасность и шифрование
- **Компоненты**: Шифрование данных, анализ безопасности сетей

#### `core.service`
- **Назначение**: Фоновые сервисы
- **Компоненты**: `WifiForegroundScanService` для полного сканирования Wi-Fi

#### `core.ui`
- **Назначение**: Общие UI компоненты
- **Компоненты**: Темы, компоненты интерфейса, ресурсы

### Feature модули

- `feature.scanner`: Сканирование Wi-Fi сетей
- `feature.analysis`: Анализ безопасности сетей
- `feature.settings`: Настройки приложения
- `feature.notifications`: Управление уведомлениями
- `feature.about`: Экран "О приложении"
- `feature.privacypolicy`: Политика конфиденциальности
- `feature.termsofservice`: Условия использования
- `feature.securityreport`: Отчет по безопасности

### Системные модули

- `di`: Модули Hilt (Dependency Injection)
- `navigation`: Навигация между экранами

## Ключевые компоненты

### WifiGuardApp
- **Назначение**: Главный класс приложения
- **Функции**:
  - Инициализация WorkManager
  - Настройка фоновых задач
  - Запуск `WifiConnectionObserver` для автоматических уведомлений

### MainActivity
- **Назначение**: Главная активность приложения
- **Функции**:
  - Обработка разрешений
  - Управление состоянием разрешений
  - Запуск UI и навигации
  - Использование StateFlow для безопасного управления состоянием

### WifiConnectionObserver
- **Назначение**: Наблюдатель за подключениями к Wi-Fi
- **Функции**:
  - Отслеживание подключений к Wi-Fi сетям в реальном времени
  - Отправка уведомлений при подключении к небезопасным сетям
  - Решение проблемы 1.1: автоматические уведомления об угрозах

### WifiMonitoringWorker
- **Назначение**: Фоновая задача для периодического сканирования Wi-Fi
- **Функции**:
  - Периодический мониторинг активных Wi-Fi сетей
  - Анализ безопасности сетей
  - Создание отчетов об угрозах

## Паттерны проектирования

### Dependency Injection (Hilt)
- Используется для внедрения зависимостей
- Упрощает тестирование
- Обеспечивает слабую связанность компонентов

### Repository Pattern
- Централизованная точка доступа к данным
- Объединяет несколько источников данных
- Обеспечивает единообразный интерфейс для слоя домена

### State Management (Jetpack Compose)
- Использование StateFlow и SharedFlow для управления состоянием
- Thread-safe обновления UI
- Избежание race conditions и memory leaks

### Observer Pattern
- LiveData и Flow для реактивного программирования
- Автоматическое обновление UI при изменении данных
- Эффективное управление жизненным циклом

## Безопасность архитектуры

### Шифрование данных
- AES-256-GCM для шифрования чувствительных данных
- Android Keystore для хранения ключей
- HMAC-SHA256 для проверки целостности

### Изоляция данных
- Локальное хранение данных (без передачи на серверы)
- Использование DataStore для безопасного хранения настроек
- Экспорт данных только локально

### Обработка разрешений
- Запрос минимально необходимых разрешений
- Безопасная обработка результатов запросов разрешений
- Поддержка новых требований Android 13+ (NEARBY_WIFI_DEVICES)