# Android Permissions Guide - WifiGuard

## Обзор разрешений

WifiGuard запрашивает минимально необходимые разрешения для обеспечения функциональности анализа безопасности Wi-Fi сетей с максимальной защитой конфиденциальности пользователя.

## Обязательные разрешения

### 1. `ACCESS_FINE_LOCATION` (Точное местоположение)

**Тип**: Обязательное  
**Версия**: Android 6+ (API 23+)  
**Использование**: Сканирование Wi-Fi сетей  
**Причина запроса**: Android требует это разрешение для получения списка доступных Wi-Fi сетей, даже если приложение не использует данные местоположения.

**Примечание**: Это требование Android, а не функциональность отслеживания местоположения.

### 2. `ACCESS_COARSE_LOCATION` (Приблизительное местоположение)

**Тип**: Дополнительное (резервное)  
**Использование**: Альтернативное разрешение для сканирования Wi-Fi  
**Назначение**: Резервное разрешение в случае проблем с точным местоположением.

### 3. `ACCESS_WIFI_STATE` (Доступ к состоянию Wi-Fi)

**Тип**: Обязательное  
**Использование**: Получение информации о состоянии и подключениях Wi-Fi  
**Назначение**: Основная функциональность приложения для анализа сетей.

### 4. `CHANGE_WIFI_STATE` (Изменение состояния Wi-Fi)

**Тип**: Обязательное  
**Использование**: Управление подключениями к Wi-Fi сетям  
**Назначение**: Возможность подключения/отключения от сетей для тестирования безопасности.

## Разрешения Android 13+ (API 33+)

### 5. `POST_NOTIFICATIONS` (Отправка уведомлений)

**Тип**: Обязательное  
**Версия**: Android 13+  
**Использование**: Отправка уведомлений об угрозах безопасности  
**Назначение**: Информирование пользователя о подключении к небезопасным сетям.

### 6. `NEARBY_WIFI_DEVICES` (Устройства поблизости)

**Тип**: Обязательное  
**Версия**: Android 13+  
**Использование**: Сканирование Wi-Fi сетей без привязки к местоположению  
**Флаг**: `neverForLocation` - гарантирует, что приложение физически не может использовать это разрешение для отслеживания перемещений.

## Фоновые разрешения

### 7. `WAKE_LOCK` (Блокировка сна)

**Тип**: Обязательное  
**Использование**: Поддержание активности устройства при фоновом мониторинге  
**Назначение**: Обеспечение непрерывной работы фоновых задач безопасности.

### 8. `RECEIVE_BOOT_COMPLETED` (Получение после перезагрузки)

**Тип**: Обязательное  
**Использование**: Возобновление фонового мониторинга безопасности после перезагрузки устройства  
**Назначение**: Автоматический запуск задач после перезапуска системы.

## Фоновые службы (Android 9+)

### 9. `FOREGROUND_SERVICE` (Фоновая служба)

**Тип**: Обязательное  
**Версия**: Android 9+  
**Использование**: Запуск фоновых служб для мониторинга безопасности  
**Назначение**: Обеспечение работы фоновых задач в соответствии с требованиями Android.

### 10. `FOREGROUND_SERVICE_LOCATION` (Фоновая служба с местоположением)

**Тип**: Обязательное  
**Версия**: Android 14+ (upside_down_cake)  
**Использование**: Фоновые службы, требующие доступ к местоположению  
**Назначение**: Соответствие новым требованиям Android для фоновых служб.

## Сетевая безопасность

### 11. `INTERNET` (Доступ к интернету)

**Тип**: Обязательное (для проверки подключения)  
**Использование**: Проверка состояния сетевого подключения  
**ВАЖНО**: Приложение НЕ передает никакие данные на внешние серверы. Используется только для проверки сетевого состояния.

### 12. `ACCESS_NETWORK_STATE` (Доступ к состоянию сети)

**Тип**: Обязательное  
**Использование**: Проверка состояния всех сетевых подключений  
**Назначение**: Мониторинг сетевой активности для анализа безопасности.

## Обработка разрешений в приложении

### MainActivity.kt

Приложение корректно обрабатывает следующие состояния разрешений:

- `PermissionState.UNKNOWN` - начальное состояние
- `PermissionState.GRANTED` - все разрешения предоставлены
- `PermissionState.DENIED` - разрешения отклонены, можно запросить снова
- `PermissionState.PERMANENTLY_DENIED` - разрешения заблокированы навсегда

### Логика запроса разрешений

```kotlin
// Критические разрешения для основной функциональности:
- ACCESS_FINE_LOCATION
- ACCESS_WIFI_STATE
- POST_NOTIFICATIONS (для Android 13+)
```

### Поведение при отсутствии разрешений

1. Если критические разрешения не предоставлены:
   - Показывается экран запроса разрешений
   - Основная функциональность заблокирована

2. Если разрешения отклонены однократно:
   - Повторный запрос при следующем запуске

3. Если разрешения отклонены навсегда:
   - Предложение открыть настройки приложения

## Безопасность разрешений

### NEVER_FOR_LOCATION

Разрешение `NEARBY_WIFI_DEVICES` используется с флагом `neverForLocation`, что гарантирует:

- Физическая невозможность использования для отслеживания местоположения
- Прозрачность для пользователей
- Соответствие требованиям Google Play

### Минимизация

- Приложение запрашивает только минимально необходимые разрешения
- Нет разрешений на доступ к личным данным (контакты, SMS, календарь и т.д.)
- Нет разрешений на запись/чтение файлов без необходимости

## Рекомендации для пользователей

### Как управлять разрешениями

1. Откройте настройки Android
2. Перейдите в раздел "Приложения"
3. Найдите "WifiGuard"
4. Выберите "Разрешения"
5. Управляйте каждым разрешением отдельно

### Настройка фоновой активности

Для корректной работы фонового мониторинга:

1. Убедитесь, что приложение не находится в списке "оптимизированных" приложений
2. Для Xiaomi, Huawei, OnePlus: добавьте в автозапуск
3. Отключите агрессивную оптимизацию батареи для приложения

## Влияние на конфиденциальность

### Что НЕ собирает приложение

- Нет доступа к личным данным пользователя
- Нет передачи данных на серверы
- Нет отслеживания местоположения
- Нет анализа личной активности

### Что использует приложение

- Только информацию о Wi-Fi сетях (SSID, BSSID, уровень сигнала, тип шифрования)
- Только для анализа безопасности локально на устройстве
- Все данные хранятся локально и могут быть очищены пользователем

## Совместимость с версиями Android

| Разрешение | Android 8-11 | Android 12 | Android 13+ |
|------------|--------------|------------|-------------|
| ACCESS_FINE_LOCATION | Обязательное | Обязательное | Обязательное |
| POST_NOTIFICATIONS | Нет | Нет | Обязательное |
| NEARBY_WIFI_DEVICES | Нет | Нет | Обязательное* |
| FOREGROUND_SERVICE_LOCATION | Нет | Нет | Обязательное* |

* Только с флагом `neverForLocation`

## Решение проблем с разрешениями

### Если приложение не работает

1. Проверьте все разрешения в настройках
2. Убедитесь, что все критические разрешения предоставлены
3. Перезапустите приложение после предоставления разрешений
4. Если разрешения отклонены навсегда, откройте настройки через приложение

### Для разработчиков

Разрешения объявлены в `AndroidManifest.xml` и запрашиваются в `MainActivity.kt` с использованием:

- `ActivityResultContracts.RequestMultiplePermissions()` для запроса
- `shouldShowRequestPermissionRationale()` для определения состояния
- `StateFlow` для безопасного обновления UI на основе состояния разрешений